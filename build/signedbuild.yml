name: $(date:yyyy-MM-dd)$(rev:.rr)
trigger: none
pr: none
variables:
  BuildPlatform: 'x86'
  MAICreateNuget: 'true'
  PublicRelease: 'true'
  SignAppForRelease: 'false'
  TeamName: 'Accessibility Insights Windows'
  system.debug: 'true' #set to true in case our signed build flakes out again
  runCodesignValidationInjection: 'false'

jobs:
- job: StaticAnalysisTest
  pool:
    vmImage: 'windows-2019'
  variables:
    PublicRelease: 'false'
  steps:
  - task: NuGetToolInstaller@1
    displayName: 'Use NuGet 5.x'
    inputs:
      versionSpec: '5.x'

  - task: PowerShell@2
    displayName: 'Show Variables'
    inputs:
      targetType: 'inline'
      script: 'dir env:'

  - task: PowerShell@2
    displayName: 'Enumerate scanner files'
    inputs:
      targetType: 'inline'
      script: 'get-childitem -recurse $env:AGENT_ROOTDIRECTORY\_tasks\wpf-static-analysis_4e47c0d8-ab6d-4a21-8f27-e7a48d275df9'

  - task: NuGetCommand@2
    displayName: 'NuGet restore'

  - task: DotNetCoreCLI@2
    displayName: 'dotnet restore'
    inputs:
      command: restore
      projects: |
        **\*.csproj

  - task: VSBuild@1
    displayName: 'Build Solution **\*.sln'
    inputs:
      vsVersion: 16.0
      platform: '$(BuildPlatform)'
      configuration: release

  - task: ms.build-release-task.custom-build-release-task.wpf-static-analysis@0
    displayName: 'WPF Static Analysis'
    inputs:
      input: 'src\AccessibilityInsights\bin\Release\net472'
      suppress: 'file:Microsoft.VisualStudio.Services.Client.Interactive.dll'

  - task: ms-vseng.MicroBuildTasks.521a94ea-9e68-468a-8167-6dcf361ea776.MicroBuildCleanup@1
    displayName: 'Perform Cleanup Tasks'
    condition: succeededOrFailed()
